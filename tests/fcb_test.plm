/*
 * FCB Test - dump default FCB contents
 */

0100H:

MON1: PROCEDURE(FUNC, PARM) EXTERNAL;
    DECLARE FUNC BYTE, PARM ADDRESS;
END MON1;

DECLARE
    CONOUT LITERALLY '2',
    PRTSTR LITERALLY '9';

DECLARE FCB(36) BYTE AT(005CH);

PRINTCHAR: PROCEDURE(C);
    DECLARE C BYTE;
    CALL MON1(CONOUT, C);
END PRINTCHAR;

CRLF: PROCEDURE;
    CALL PRINTCHAR(13);
    CALL PRINTCHAR(10);
END CRLF;

PRINTHEX: PROCEDURE(B);
    DECLARE B BYTE;
    DECLARE N BYTE;
    N = SHR(B, 4);
    IF N > 9 THEN CALL PRINTCHAR(N + 'A' - 10);
    ELSE CALL PRINTCHAR(N + '0');
    N = B AND 0FH;
    IF N > 9 THEN CALL PRINTCHAR(N + 'A' - 10);
    ELSE CALL PRINTCHAR(N + '0');
END PRINTHEX;

MAIN: PROCEDURE;
    DECLARE I BYTE;

    CALL CRLF;
    /* Print FCB hex dump */
    DO I = 0 TO 35;
        CALL PRINTHEX(FCB(I));
        CALL PRINTCHAR(' ');
        IF (I AND 0FH) = 0FH THEN CALL CRLF;
    END;
    CALL CRLF;

    /* Print filename as chars */
    DO I = 1 TO 11;
        IF FCB(I) >= ' ' THEN CALL PRINTCHAR(FCB(I));
        ELSE CALL PRINTCHAR('?');
    END;
    CALL CRLF;

END MAIN;

CALL MAIN;

EOF
